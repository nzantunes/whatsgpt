<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WhatsGPT - Configurações</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #128C7E;
      --primary-dark: #075e54;
      --secondary-color: #25D366;
      --light-bg: #f5f5f5;
      --card-shadow: 0 4px 20px rgba(0,0,0,0.1);
      --border-radius: 15px;
      --section-spacing: 1.5rem;
    }
    
    body {
      background-color: var(--light-bg);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      color: #333;
    }
    
    .navbar {
      background-color: var(--primary-dark);
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .navbar-brand {
      color: white;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .navbar-brand i {
      font-size: 1.25rem;
    }
    
    .navbar-nav .nav-link {
      color: rgba(255,255,255,0.85);
      transition: all 0.2s ease;
      border-radius: 5px;
      padding: 0.5rem 1rem;
      margin: 0 0.25rem;
    }
    
    .navbar-nav .nav-link:hover {
      color: white;
      background-color: rgba(255,255,255,0.1);
    }
    
    .navbar-nav .nav-link.active {
      background-color: rgba(255,255,255,0.2);
      color: white;
    }
    
    main {
      flex: 1;
      padding: 2rem 0;
    }
    
    .section-title {
      margin-bottom: 1rem;
      color: var(--primary-dark);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .card {
      border-radius: var(--border-radius);
      box-shadow: var(--card-shadow);
      overflow: hidden;
      margin-bottom: 2rem;
      border: none;
    }
    
    .card-header {
      background-color: var(--primary-dark);
      color: white;
      font-weight: 600;
      padding: 15px 20px;
    }
    
    .config-section {
      border-top: 1px solid #eee;
      padding: var(--section-spacing) 0;
    }
    
    .config-section:first-child {
      border-top: none;
    }
    
    .btn-primary {
      background-color: var(--primary-dark);
      border-color: var(--primary-dark);
    }
    
    .btn-primary:hover {
      background-color: #064942;
      border-color: #064942;
    }
    
    .config-list-item {
      border-left: 4px solid transparent;
      margin-bottom: 10px;
      transition: all 0.2s ease;
      border-radius: 0 5px 5px 0;
    }
    
    .config-list-item:hover {
      border-left-color: var(--primary-dark);
      background-color: rgba(7, 94, 84, 0.05);
    }
    
    .config-list-item.active {
      border-left-color: var(--primary-dark);
      background-color: rgba(7, 94, 84, 0.1);
    }
    
    .notification-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
    }
    
    .notification {
      background-color: white;
      padding: 15px 20px;
      margin-bottom: 10px;
      border-radius: 5px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      animation: slideIn 0.3s ease;
      max-width: 350px;
    }
    
    .notification.success {
      border-left: 4px solid #28a745;
    }
    
    .notification.error {
      border-left: 4px solid #dc3545;
    }
    
    .notification.info {
      border-left: 4px solid #17a2b8;
    }
    
    .notification.warning {
      border-left: 4px solid #ffc107;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .footer {
      background-color: #343a40;
      color: white;
      padding: 1.5rem 0;
      margin-top: 2rem;
    }
    
    #url-list, #pdf-list, #xlsx-list, #csv-list {
      list-style: none;
      padding: 0;
    }
    
    #url-list li, #pdf-list li, #xlsx-list li, #csv-list li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      margin-bottom: 8px;
      background-color: #f8f9fa;
      border-radius: 6px;
      word-break: break-all;
      border-left: 3px solid var(--primary-color);
      transition: all 0.2s ease;
    }
    
    #url-list li:hover, #pdf-list li:hover, #xlsx-list li:hover, #csv-list li:hover {
      background-color: #e9ecef;
    }
    
    #pdf-list li {
      border-left-color: #dc3545;
    }
    
    #xlsx-list li {
      border-left-color: #28a745;
    }
    
    #csv-list li {
      border-left-color: #ffc107;
    }
    
    #loading-indicator {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(7, 94, 84, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-dark);
      animation: spin 1s ease-in-out infinite;
      margin-left: 10px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .file-input-container {
      background-color: #f8f9fa;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    
    .info-badge {
      background-color: rgba(7, 94, 84, 0.1);
      color: var(--primary-dark);
      padding: 4px 8px;
      border-radius: 4px;
      margin-right: 10px;
      font-size: 0.85rem;
    }
    
    .form-control:focus, .form-select:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.25rem rgba(7, 94, 84, 0.25);
    }
    
    .helper-text {
      font-size: 0.85rem;
      color: #6c757d;
      margin-top: 0.5rem;
    }
    
    .input-group-text {
      background-color: var(--primary-dark);
      color: white;
      border: none;
    }
    
    .section-divider {
      display: flex;
      align-items: center;
      margin: 1.5rem 0;
    }
    
    .section-divider::before,
    .section-divider::after {
      content: "";
      flex: 1;
      height: 1px;
      background-color: #dee2e6;
    }
    
    .section-divider-text {
      padding: 0 1rem;
      color: #6c757d;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <!-- Container para notificações -->
  <div id="notification-container" class="notification-container"></div>

  <!-- Barra de navegação -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand" href="/config">
        <i class="bi bi-robot"></i> <span class="logo-text">Whats<span class="logo-highlight">GPT</span></span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link active" href="/config"><i class="bi bi-gear-fill"></i> Configurações</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/qrcode"><i class="bi bi-qr-code"></i> QR Code</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/logout"><i class="bi bi-box-arrow-right"></i> Sair</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Conteúdo principal -->
  <main class="container">
    <div class="row">
      <!-- Lista de configurações (Coluna da esquerda) -->
      <div class="col-md-4">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span><i class="bi bi-list-ul"></i> Configurações Salvas</span>
            <button id="new-config-btn" class="btn btn-sm btn-light">
              <i class="bi bi-plus-circle"></i> Nova
            </button>
          </div>
          <div class="card-body" style="max-height: 600px; overflow-y: auto;">
            <div id="config-list" class="list-group list-group-flush">
              <div id="configs-loading" class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Carregando...</span>
                </div>
                <p class="mt-2">Carregando configurações...</p>
              </div>
              <div id="empty-configs" class="text-center py-4" style="display: none;">
                <i class="bi bi-exclamation-circle text-muted" style="font-size: 2rem;"></i>
                <p class="mt-2">Nenhuma configuração encontrada.</p>
                <button class="btn btn-primary btn-sm" id="create-first-config">
                  <i class="bi bi-plus-circle"></i> Criar primeira configuração
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Formulário de configuração (Coluna da direita) -->
      <div class="col-md-8">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span id="edit-title"><i class="bi bi-pencil-square"></i> Nova Configuração</span>
            <div>
              <button id="btn-test-gpt" class="btn btn-sm btn-outline-light me-2" disabled>
                <i class="bi bi-chat-dots"></i> Testar
              </button>
              <button id="btn-delete" class="btn btn-sm btn-outline-danger" disabled>
                <i class="bi bi-trash"></i> Excluir
              </button>
            </div>
          </div>
          <div class="card-body">
            <form id="config-form">
              <input type="hidden" id="config-id">
              
              <!-- Seção de Configurações Básicas -->
              <div class="config-section">
                <h5 class="section-title"><i class="bi bi-gear"></i> Configurações Básicas</h5>
                
                <div class="mb-3">
                  <label for="config-name" class="form-label">Nome da configuração <span class="text-danger">*</span></label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-tag"></i></span>
                    <input type="text" class="form-control" id="config-name" placeholder="Ex: Atendimento Clientes" required>
                  </div>
                  <div class="helper-text">Escolha um nome descritivo para identificar facilmente esta configuração.</div>
                </div>
                
                <div class="mb-3">
                  <label for="config-prompt" class="form-label">Prompt personalizado <span class="text-danger">*</span></label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-chat-left-text"></i></span>
                    <textarea class="form-control" id="config-prompt" rows="4" placeholder="Instruções para o assistente GPT" required></textarea>
                  </div>
                  <div class="helper-text">Define como o assistente deve se comportar e o contexto das respostas. Seja específico para obter melhores resultados.</div>
                </div>
                
                <div class="mb-3">
                  <label for="config-info" class="form-label">Informações adicionais</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-info-circle"></i></span>
                    <textarea class="form-control" id="config-info" rows="3" placeholder="Detalhes extras para o assistente usar nas respostas"></textarea>
                  </div>
                  <div class="helper-text">Informações específicas que o bot deve ter conhecimento (horário de funcionamento, políticas, etc).</div>
                </div>
                
                <div class="mb-3">
                  <label for="config-model" class="form-label">Modelo GPT</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-cpu"></i></span>
                    <select class="form-select" id="config-model">
                      <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Rápido e econômico)</option>
                      <option value="gpt-4o">GPT-4o (Mais inteligente e preciso)</option>
                    </select>
                  </div>
                  <div class="helper-text">O GPT-4o é mais avançado e tem maior capacidade de compreensão, mas pode ser mais lento.</div>
                </div>
              </div>
              
              <div class="section-divider">
                <span class="section-divider-text">FONTES DE CONHECIMENTO</span>
              </div>
              
              <!-- Seção de URLs -->
              <div class="config-section">
                <h5 class="section-title"><i class="bi bi-globe"></i> Sites e Páginas Web</h5>
                <div class="helper-text mb-3">O bot extrairá automaticamente o conteúdo destes sites para responder às perguntas.</div>
                
                <div class="file-input-container">
                  <div class="input-group mb-2">
                    <span class="input-group-text"><i class="bi bi-link-45deg"></i></span>
                    <input type="text" class="form-control" id="new-url" placeholder="https://exemplo.com">
                    <button class="btn btn-primary" type="button" id="add-url-btn">
                      <i class="bi bi-plus"></i> Adicionar
                    </button>
                  </div>
                  <div class="helper-text">Adicione URLs completas de páginas que contêm informações relevantes.</div>
                  <ul id="url-list" class="mb-0 mt-3"></ul>
                </div>
              </div>
              
              <!-- Seção de Arquivos -->
              <div class="config-section">
                <h5 class="section-title"><i class="bi bi-file-earmark"></i> Arquivos e Documentos</h5>
                <div class="helper-text mb-3">Carregue arquivos com informações que o bot deve utilizar para responder às perguntas.</div>
                
                <!-- PDF -->
                <div class="file-input-container">
                  <div class="d-flex align-items-center mb-2">
                    <span class="info-badge"><i class="bi bi-file-earmark-pdf"></i> PDF</span>
                    <span>Documentos, manuais e textos longos</span>
                  </div>
                  <div class="input-group mb-2">
                    <input type="file" class="form-control" id="pdf-upload" accept=".pdf" multiple>
                    <button class="btn btn-primary" type="button" id="process-pdf-btn">
                      <i class="bi bi-upload"></i> Processar
                    </button>
                  </div>
                  <div class="helper-text">Ideal para manuais, procedimentos, políticas ou documentos oficiais. O texto será extraído automaticamente.</div>
                  <ul id="pdf-list" class="mb-0 mt-3"></ul>
                  <div id="pdf-loading" class="mt-2" style="display: none;">
                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                      <span class="visually-hidden">Processando...</span>
                    </div>
                    <small class="ms-2">Processando PDF, aguarde...</small>
                  </div>
                </div>
                
                <!-- Excel -->
                <div class="file-input-container mt-3">
                  <div class="d-flex align-items-center mb-2">
                    <span class="info-badge"><i class="bi bi-file-earmark-excel"></i> Excel</span>
                    <span>Planilhas com dados estruturados</span>
                  </div>
                  <div class="input-group mb-2">
                    <input type="file" class="form-control" id="xlsx-upload" accept=".xlsx,.xls" multiple>
                    <button class="btn btn-primary" type="button" id="process-xlsx-btn">
                      <i class="bi bi-upload"></i> Processar
                    </button>
                  </div>
                  <div class="helper-text">Perfeito para catálogos de produtos, listas de preços ou qualquer dado organizado em tabelas.</div>
                  <ul id="xlsx-list" class="mb-0 mt-3"></ul>
                  <div id="xlsx-loading" class="mt-2" style="display: none;">
                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                      <span class="visually-hidden">Processando...</span>
                    </div>
                    <small class="ms-2">Processando Excel, aguarde...</small>
                  </div>
                </div>
                
                <!-- CSV -->
                <div class="file-input-container mt-3">
                  <div class="d-flex align-items-center mb-2">
                    <span class="info-badge"><i class="bi bi-file-earmark-text"></i> CSV</span>
                    <span>Dados tabulares em formato texto</span>
                  </div>
                  <div class="input-group mb-2">
                    <input type="file" class="form-control" id="csv-upload" accept=".csv" multiple>
                    <button class="btn btn-primary" type="button" id="process-csv-btn">
                      <i class="bi bi-upload"></i> Processar
                    </button>
                  </div>
                  <div class="helper-text">Útil para grandes conjuntos de dados, estatísticas ou relatórios em formato tabular simples.</div>
                  <ul id="csv-list" class="mb-0 mt-3"></ul>
                  <div id="csv-loading" class="mt-2" style="display: none;">
                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                      <span class="visually-hidden">Processando...</span>
                    </div>
                    <small class="ms-2">Processando CSV, aguarde...</small>
                  </div>
                </div>
              </div>
              
              <!-- Botões de ação -->
              <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                <button type="button" class="btn btn-outline-secondary" id="btn-clear">
                  <i class="bi bi-arrow-clockwise"></i> Limpar Campos
                </button>
                <button type="submit" class="btn btn-primary" id="btn-save">
                  <i class="bi bi-save"></i> Salvar Configuração
                  <span id="saving-indicator" style="display: none;">
                    <span id="loading-indicator"></span>
                  </span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Modal de Confirmação de Exclusão -->
  <div class="modal fade" id="deleteConfigModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title"><i class="bi bi-exclamation-triangle"></i> Confirmar Exclusão</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <p>Tem certeza que deseja excluir a configuração <strong id="delete-config-name"></strong>?</p>
          <p class="text-danger">Esta ação não pode ser desfeita!</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-danger" id="confirm-delete-btn">
            <i class="bi bi-trash"></i> Excluir Permanentemente
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Teste do GPT -->
  <div class="modal fade" id="testGptModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title"><i class="bi bi-chat-dots"></i> Testar Configuração</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="test-message" class="form-label">Digite uma mensagem de teste:</label>
            <textarea class="form-control" id="test-message" rows="3" placeholder="Ex: Quais são os produtos disponíveis?"></textarea>
          </div>
          
          <div id="test-status-container" class="d-none mb-3">
            <div class="card">
              <div class="card-header bg-info text-white">
                <i class="bi bi-robot"></i> Resposta do GPT
              </div>
              <div class="card-body">
                <div id="loading-response" class="text-center py-3">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Processando...</span>
                  </div>
                  <p class="mt-2">Processando sua mensagem...</p>
                </div>
                <div id="gpt-test-result" class="bg-light p-3 rounded" style="white-space: pre-wrap; display: none;"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
          <button type="button" class="btn btn-primary" id="send-test-btn">
            <i class="bi bi-send"></i> Enviar Mensagem
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Rodapé -->
  <footer class="footer">
    <div class="container text-center">
      <p class="mb-1">© 2025 WhatsGPT. Todos os direitos reservados a Nain Zahailo.</p>
      <p class="mb-0">
        <i class="bi bi-envelope me-1"></i> nzantunes1@gmail.com 
        <span class="mx-2">|</span> 
        <a href="https://wa.me/5547991097740" target="_blank" class="text-white text-decoration-none">
          <i class="bi bi-whatsapp me-1"></i> (47) 99109-7740
        </a>
      </p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/config.js"></script>
</body>
</html> 